# next-pwa - custom worker example

[TOC]

This example demonstrates how to use `next-pwa` plugin to turn a `Next.js` based web application into a progressive web application easily. It demonstrates how to add custom worker code to the Service Worker generated by Workbox.

## New Method

Simply create a `worker/index.ts` and start implementing your Service Worker. `next-pwa` will detect this file automatically, and bundle the file into `dest` as `worker-*.js` using `webpack`. It's also automatically injected into the generated `sw.js`.

In this way, you get the benefit of code splitting and size minimization automatically. Yes! `require` modules works! Yes! you can share code between your web app and the Service Worker!

> - In dev mode, `worker/index.ts` is not watched, so it will not hot reload.

### Custom Worker Directory

You can customize the directory of your custom worker file by setting the `customWorkerDir` (relative to the `basedir`) in your `withPWAInit` config in `next.config.js`:

```javascript
const withPWA = require("@ducanh2912/next-pwa").default({
  customWorkerDir: "serviceworker",
  // ...
});

module.exports = withPWA({
  // Next.js config
});
```

In this example, `next-pwa` would look for `serviceworker/index.ts`.

## Old Method (Still Works)

Basically you need to create a file such as `worker.js` in `public` folder, then add the option `importScripts` to your `withPWAInit` config in `next.config.js`:

```javascript
const withPWA = require("@ducanh2912/next-pwa").default({
  dest: "public",
  importScripts: ["/worker.js"],
});

module.exports = withPWA({
  // Next.js config
});
```

Then Service Worker generated will automatically import your code and run it before other workbox code.

## Usage

[![Open in Gitpod](https://img.shields.io/badge/Open%20In-Gitpod.io-%231966D2?style=for-the-badge&logo=gitpod)](https://gitpod.io/#https://github.com/shadowwalker/next-pwa/)

```bash
cd examples/custom-ts-server
yarn install
yarn build
yarn start
```

## Recommend `.gitignore`

```
**/public/workbox-*.js
**/public/sw.js
**/public/worker-*.js
```
